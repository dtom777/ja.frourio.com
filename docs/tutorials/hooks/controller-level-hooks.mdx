---
id: controller-level-hooks
title: Controller-level hooks
---

Controller-level hooks are called at the current endpoint after directory-level hooks.  
Hooks written in contoller.ts do not cascade and are only available to that controller.

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs
  defaultValue="fastify"
  values={[
    { label: 'fastify', value: 'fastify' },
    { label: 'express', value: 'express' },
  ]
}>
<TabItem value="fastify">

[Fastify hooks](https://www.fastify.io/docs/latest/Hooks/)

```ts title="server/api/tasks/controller.ts"
import { defineHooks, defineController } from './$relay' // '$relay.ts' is automatically generated by frourio
import { getTasks, createTask } from '$/service/tasks'

export const hooks = defineHooks(() => ({
  onRequest: (req, reply, done) => {
    console.log('Controller-level onRequest single hook:', req.url)
    done()
  },
  preParsing: [
    (req, reply, payload, done) => {
      console.log('Controller-level preParsing first hook:', req.url)
      done()
    },
    (req, reply, payload, done) => {
      console.log('Controller-level preParsing second hook:', req.url)
      done()
    }
  ]
}))

export default defineController(() => ({
  get: async ({ query }) => ({
    status: 200,
    body: (await getTasks()).slice(0, query.limit)
  }),
  post: async ({ body }) => {
    const task = await createTask(body.label)

    return { status: 201, body: task }
  }
}))
```

</TabItem>
<TabItem value="express">

[Express middleware](https://expressjs.com/en/guide/using-middleware.html)

```ts title="server/api/tasks/controller.ts"
import { defineHooks, defineController } from './$relay' // '$relay.ts' is automatically generated by frourio
import { getTasks, createTask } from '$/service/tasks'

export const hooks = defineHooks(() => ({
  onRequest: (req, res, next) => {
    console.log('Controller-level onRequest single hook:', req.path)
    next()
  },
  preParsing: [
    (req, res, next) => {
      console.log('Controller-level preParsing first hook:', req.path)
      next()
    },
    (req, res, next) => {
      console.log('Controller-level preParsing second hook:', req.path)
      next()
    }
  ]
}))

export default defineController(() => ({
  get: async ({ query }) => ({
    status: 200,
    body: (await getTasks()).slice(0, query.limit)
  }),
  post: async ({ body }) => {
    const task = await createTask(body.label)

    return { status: 201, body: task }
  }
}))
```

</TabItem>
</Tabs>
