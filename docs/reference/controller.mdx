---
id: controller
title: コントローラー
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

```ts title='controller.ts'
import { defineController } from './$relay';

export default defineController(() => ({
  get: () => ({ status: 200, body: 'Hello' }),
  post: async ({ query: { foo }, params: { bar }, body }) => {
    const baz = await createBaz(foo, bar, body);
    if (!baz) return { status: 400 };
    return { status: 201, body: baz };
  },
}));
```

コントローラーを定義するには、`./$relay.ts` から export された `defineMethods` 関数を使用します。

defineController の型定義は aspida の型定義に基づいて自動的に生成されます。そのため、コントローラーと同じディレクトリにある `$relay.ts` から import する必要があります。

defineController の戻り値は default export する必要があります。

コントローラーで fastify インスタンスを使用したい場合は、それを引数にとることができます。

## `defineController` 関数 {#function-definecontroller}

### 引数の型 {#definecontoller-argument-type}

<Tabs
  groupId='base-framework'
  defaultValue="fastify"
  values={[
    { label: 'Fastify', value: 'fastify' },
    { label: 'Express', value: 'express' },
  ]}
>
<TabItem value="fastify">

- function `(fastify: FastifyInstance) => ControllerMethods`
  - [`FastifyInstance`](https://www.fastify.io/docs/latest/Reference/TypeScript/#fastifyfastifyinstancerawserver-rawrequest-requestgeneric-logger)
  - `ControllerMethods` : メソッド名を key とし、リクエストハンドラを value とするオブジェクト

</TabItem>
<TabItem value="express">

- function `(app: Express) => ControllerMethods`
  - [`Express`](https://expressjs.com/en/4x/api.html)
  - `ControllerMethods` : メソッド名を key とし、リクエストハンドラを value とするオブジェクト

</TabItem>
</Tabs>

### 戻り値の型 {#definecontoller-return-type}

- object `ControllerMethods`

## リクエストハンドラ {#value-of-controllermethods}

### 引数の型 {#controllermethods-argument-type}

- object `RequestParams` & [`AdditinalRequest`](/docs/reference/additionalRequest)
  - `query` : `query`
  - `headers` : `reqHeaders`
  - `params` : URL Params
  - `body` : `reqBody`

### 戻り値の型 {#controllermethods-return-type}

- object `ServerResponse` | promise `Promise<ServerResponse>`
  - `status` : `status`
  - `body` : `resBody`
  - `headers` : `resHeaders`

`RequestParams` 型と `ServerResponse` 型は API 型定義に基づいて決定されます。

また、それぞれのリクエストハンドラは同期・非同期どちらでも可能です。
